<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="egovframework.com.bidserver.enterprise.service.impl.EnterpriseMapper">
	
	<select id="selectManufactureList" parameterType="map" resultType="HashMap">
	/* 제조사 정보 조회 (manufacture.selectManufactureList) */	    
	  SELECT
		    business_no,
		    company_no,
		    company_nm,
		    delegate,
		    delegate_explain,
		    delegate_explain2,
		    delegate_explain3,
		    company_type,
		    case when company_type = '1' or company_type = '3' then 'Y' else 'N' end company_type1,
		    case when company_type = '2' or company_type = '3' then 'Y' else 'N' end company_type2,
		    case when length(business_no) > 0 then '1' else '0' end company_type_insert,
		    address,
		    fn_common_nm('main_area_cd',address, null, null) as address_nm, 
		    address_detail,
		    phone_no,
		    mobile_no,
		    position,
		    bidmanager,
		    email,
		    bigo,
	  		unuse_yn
		FROM tn_bid_company_info 
		WHERE gubun='B'
		    <if test="s_company_no!=null and !s_company_no.equals('')">  and company_no like CONCAT('%', #{s_company_no}, '%')            </if>
		    <if test="s_company_nm!=null and !s_company_nm.equals('')">  and company_nm like CONCAT('%', #{s_company_nm}, '%')            </if>
		    <if test="s_bidmanager!=null and !s_bidmanager.equals('')">  and bidmanager like CONCAT('%', #{s_bidmanager}, '%')            </if>
		    <if test="s_area_cd!=null and !s_area_cd.equals('')">  and address = ${s_area_cd}           </if>
		    <if test="s_area_txt!=null and !s_area_txt.equals('')">  and address_detail like CONCAT('%', #{s_area_txt}, '%')            </if>
			<if test="s_delegate_explain_txt!=null and !s_delegate_explain_txt.equals('')">  
				and (delegate_explain like CONCAT('%', #{s_delegate_explain_txt}, '%') or delegate_explain2 like CONCAT('%', #{s_delegate_explain_txt}, '%') or
				delegate_explain3 like CONCAT('%', #{s_delegate_explain_txt}, '%'))              
			</if>
		<trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
			        <choose>
						<when test="sort.equals('address')"> address</when>
						<otherwise> #{sort}</otherwise>
					</choose>
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			    <otherwise>
			    	company_nm asc
			    </otherwise>
			</choose>
        </trim>
		Limit #{pageNo}, #{rows}
	</select>
	
    <select id="getManufactureListCnt" parameterType="map" resultType="Integer">
		SELECT count(*) as cnt 
		from tn_bid_company_info
		WHERE gubun='B'
		    <if test="s_company_no!=null and !s_company_no.equals('')">  and company_no like CONCAT('%', #{s_company_no}, '%')            </if>
		    <if test="s_company_nm!=null and !s_company_nm.equals('')">  and company_nm like CONCAT('%', #{s_company_nm}, '%')            </if>
		    <if test="s_bidmanager!=null and !s_bidmanager.equals('')">  and bidmanager like CONCAT('%', #{s_bidmanager}, '%')            </if>
		    <if test="s_area_cd!=null and !s_area_cd.equals('')">  and address = ${s_area_cd}           </if>
			<if test="s_delegate_explain_txt!=null and !s_delegate_explain_txt.equals('')">  
				and (delegate_explain like CONCAT('%', #{s_delegate_explain_txt}, '%') or delegate_explain2 like CONCAT('%', #{s_delegate_explain_txt}, '%') or
				delegate_explain3 like CONCAT('%', #{s_delegate_explain_txt}, '%'))              
			</if>
	</select>
	
	<update id="insertManufacture" parameterType="map">
	    /* 제조사 저장 (insertManufacture) */	    
	  		INSERT INTO tn_bid_company_info
					(
					business_no,
					company_no,
					company_nm,
					delegate,
					delegate_explain,
					delegate_explain2,
					delegate_explain3,
					company_type,
					address,
					address_detail,
					phone_no,
					mobile_no,
					position,
					bidmanager,
					email,
					unuse_yn,
					gubun
					)
			VALUES
				(			
				   #{business_no},
				   #{company_no},
				   #{company_nm},
				   #{delegate},
				   #{delegate_explain},
				   #{delegate_explain2},
				   #{delegate_explain3},
				   #{company_type},
				   #{address},
				   #{address_detail},
				   #{phone_no},
				   #{mobile_no},
				   #{position},
				   #{bidmanager},
				   #{email},
				   #{unuse_yn},
				   #{gubun}     				
				)
	</update>
	
	<update id="updateManufacture" parameterType="map">
	    /* 제조사 수정 (updateManufacture) */	    
			update tn_bid_company_info
				set
					company_no 				= #{company_no},
					company_nm 				= #{company_nm},
					delegate 				= #{delegate},
					delegate_explain 		= #{delegate_explain},
					delegate_explain2 		= #{delegate_explain2},
					delegate_explain3 		= #{delegate_explain3},
					company_type 			= #{company_type},
					address 				= #{address},
					address_detail 			= #{address_detail},
					phone_no 				= #{phone_no},
					mobile_no 				= #{mobile_no},
					position 				= #{position},
					bidmanager				= #{bidmanager},
					email 					= #{email},
					unuse_yn 				= #{unuse_yn}
			where	business_no = #{business_no}			
    </update>
    
    <update id="deleteManufacture" parameterType="map">
	    /* 제조사 삭제 (deleteManufacture) */	    
			delete from tn_bid_company_info
			where business_no = #{business_no} and gubun = 'B'			
    </update>
    
    <update id="deleteBusiness" parameterType="map">
	    /* 투찰사 삭제 (deleteBusiness) */	    
			delete from tn_bid_company_info
			where business_no = #{business_no} and gubun = 'A'		
    </update>
    
    <update id="deleteBusinessDetail" parameterType="map">
	    /* 투찰사 상세정보 삭제 (deleteBusinessDetail) */	    
			delete from tn_bid_company_info
			where business_no = #{business_no}		
    </update>
    
    <update id="deleteBusinessGoods" parameterType="map">
	    /* 제조물품 삭제 (deleteBusinessGoods) */	    
			delete from tn_bid_business_goods
			where business_no = #{business_no}		
    </update>
    
    <update id="deleteBusinessGoodsDirect" parameterType="map">
	    /*  직접생산물품 삭제 (deleteBusinessGoodsDirect) */	    
			delete from tn_bid_business_goods_direct
			where business_no = #{business_no}		
    </update>
    
    <update id="deleteBusinessLicense" parameterType="map">
	    /* 적격목록 삭제 (deleteBusinessLicense) */	    
			delete from tn_bid_business_license
			where business_no = #{business_no}		
    </update>
    
    <update id="deleteBusinessType" parameterType="map">
	    /* 업종 삭제 (deleteBusinessType) */	    
			delete from tn_bid_business_type
			where business_no = #{business_no}		
    </update>
    
    <update id="deleteBusinessCreditDegree" parameterType="map">
	    /* 신인도 삭제 (deleteBusinessCreditDegree) */	    
			delete from tn_bid_business_credit_degree
			where business_no = #{business_no}		
    </update>
    
    <select id="selectBizHisList" parameterType="map" resultType="HashMap">
		 /* 견적이력 조회 (selectBizHisList) */
	     select A.*, B.*, B.bigo as bigo1 
		 from 	tn_bid_distribution_info A,
		 		tn_bid_manufacture_rel B
		 where A.bid_notice_no = B.bid_notice_no
		 and A.bid_notice_cha_no = B.bid_notice_cha_no
		 <!-- and B.send_yn = 'Y' -->
	     and B.business_no = #{business_no}
	     
	     <trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('bid_notice_no')"> A.bid_notice_no</if>
				    <if test="sort.equals('bid_notice_nm')"> A.bid_notice_nm</if>
				    <if test="sort.equals('noti_dt')"> A.noti_dt</if>
				    <if test="sort.equals('margin')"> B.margin</if>
				    <if test="sort.equals('bigo1')"> B.bigo</if>
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			</choose>
           </trim> 
	</select>
	
	<select id="selectBizNotiHisList" parameterType="map" resultType="HashMap">
	    /* 기업비고정보 불러오기 (selectBizNotiHisList) */	    
         select A.his_id,
         A.business_no,
         A.bigo, A.del_yn,
         (select user_nm from tn_user_info where user_id=A.create_id) as user_nm,
         create_id, 
         date_format(create_dt,'%Y%m%d') as create_dt
         from tn_bid_company_noti_his A
         where A.business_no = #{business_no}
         and A.del_yn = 'N'
     </select>
     
     <update id="insertBizNotiHisList" parameterType="map">
	    /* 기업비고정보 저장 (insertBizNotiHisList) */	    
	  		INSERT INTO tn_bid_company_noti_his
					(
					business_no,
					bigo,
					del_yn,
					create_id,
					create_dt,
					modify_id,
					modify_dt
					)
			VALUES
				(			
				   #{business_no},
				   #{bigo},
				   #{del_yn},
				   #{userId},
				   sysdate(),
				   #{userId},
				   sysdate()
				)
    </update>
     <update id="updateBizNotiHisList" parameterType="map">
	    /* 기업비고정보 저장 (updateBizNotiHisList) */	    
			update tn_bid_company_noti_his
			bigo 				= #{bigo},
			modify_id 			= #{userId},
			modify_dt 			= sysdate()
			where his_id = #{his_id}
    </update>
     <update id="deleteBizNotiHisList" parameterType="map">
	    /* 기업비고정보 삭제 (deleteBizNotiHisList) */	    
			update tn_bid_company_noti_his
			set
			del_yn 				= #{del_yn},
			modify_id 			= #{userId},
			modify_dt 			= sysdate()
			where his_id = #{his_id}
    </update>
    
    <select id="selectBidReportList" parameterType="map" resultType="HashMap">
		 /* 견적보고서 조회 (selectBidReportList) */
	     SELECT  (select user_nm from tn_user_info where user_id=A.user_id) user_nm,
				(select user_nm from tn_user_info where user_id=C.apply_user_id1) user_nm1,
				(select user_nm from tn_user_info where user_id=C.apply_user_id2) user_nm2,
				(select user_nm from tn_user_info where user_id=C.apply_user_id3) user_nm3,
				date_format(c.apply_dt1,'%Y.%m.%d %H:%i:%S') apply_dt_nm1,
				date_format(c.apply_dt2,'%Y.%m.%d %H:%i:%S') apply_dt_nm2,
				date_format(c.apply_dt3,'%Y.%m.%d %H:%i:%S') apply_dt_nm3,
				fn_common_nm('apply_status_cd',status_cd1, null, null) status_nm1,
				fn_common_nm('apply_status_cd',status_cd2, null, null) status_nm2,
				fn_common_nm('apply_status_cd',status_cd3, null, null) status_nm3,
				A.*,B.*,C.*
		from 
		tn_bid_distribution_info A
		left outer join
		tn_bid_notice_file B
		on A.bid_notice_no = B.bid_notice_no  
		and A.bid_notice_cha_no = B.bid_notice_cha_no
		,tn_bid_apply_info C
		,tn_bid_manufacture_rel D
		where  A.bid_notice_no = C.bid_notice_no  
		and A.bid_notice_cha_no = C.bid_notice_cha_no
		and A.bid_notice_no = D.bid_notice_no
		and A.bid_notice_cha_no = D.bid_notice_cha_no
		and D.business_no = #{business_no}
		<trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('bid_notice_nm')"> A.bid_notice_nm</if>
				    <if test="sort.equals('bid_notice_no')"> A.bid_notice_no</if>
					<if test="sort.equals('noti_dt')">A.noti_dt </if>
					<if test="sort.equals('demand_nm')">A.demand_nm </if>
					<if test="sort.equals('bid_start_dt')">A.bid_start_dt </if>
					<if test="sort.equals('bid_end_dt')">A.bid_end_dt </if>
					<if test="sort.equals('contract_type_nm')">A.contract_type_nm </if>
			    </when>
			</choose>
           </trim> 
	</select>
	
	<update id="insertBusiness" parameterType="map">
	    /* 투찰사 저장 (insertBusiness) */	    
	  		INSERT INTO tn_bid_company_info
					(
					business_no,
					company_no,
					company_nm,
					delegate,
					company_type,
					address,
					address_detail,
					phone_no,
					mobile_no,
					position,
					bidmanager,
					email,
					pwd,
					join_route,
					unuse_yn,
					gubun
					)
			VALUES
				(			
				   #{business_no},
				   #{company_no},
				   #{company_nm},
				   #{delegate},
				   #{company_type},
				   #{address},
				   #{address_detail},
				   #{phone_no},
				   #{mobile_no},
				   #{position},
				   #{bidmanager},
				   #{email},
				   SUBSTR(CONCAT(MD5(RAND()),MD5(RAND())),1,8),
				   #{join_route},
				   #{unuse_yn},
				   #{gubun}     				
				)
		<selectKey resultType="int" keyProperty="business_no" order="AFTER">
	        SELECT LAST_INSERT_ID() 
	    </selectKey>  
	</update>
	
	<update id="insertBusinessDetail" parameterType="map">
	    /* 투찰사 저장 (insertBusiness) */	    
	  		INSERT INTO tn_bid_company_detail
					(
					business_no
					,start_dt
					,credit_cd
					,credit_dt
					,female_yn
					,female_dt
					,scale_cd
					,scale_dt
					,create_id
					,create_dt
					,modify_id
					,modify_dt
					)
			VALUES
				(			
				   	#{business_no},
 					#{open_day},
 					#{credit_cd},
 					#{credit_dt},
 					#{female_yn},
 					#{female_dt},
 					#{scale_cd},
 					#{scale_dt},
 					#{user},
 					sysdate(),
 					#{user},
 					sysdate()
				) 
	</update>
	
	<update id="deleteCompanyType" parameterType="map">
		 /* 제조사 업종 삭제 (deleteCompanyType) */
	     DELETE from tn_bid_business_type
         WHERE business_no =  #{business_no}
	</update>
	
	<update id="insertCompanyType" parameterType="map">
	        /* 제조사 업종 등록 (insertCompanyType) */
		    insert into tn_bid_business_type
		    (
		    business_no,
		    company_type_cd,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{company_type_cd},
		    sysdate(),
		    sysdate()
		    )
	</update>
	
	<update id="deleteGoodsType" parameterType="map">
		 /* 제조사 제조물품 삭제 (deleteGoodsType) */
	     DELETE from tn_bid_business_goods
         WHERE business_no =  #{business_no}
	</update>
	
	<update id="insertGoodsType" parameterType="map">
	        /* 제조사 제조물품 등록 (insertGoodsType) */
		    insert into tn_bid_business_goods
		    (
		    business_no,
		    goods_no,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{goods_no},
		    sysdate(),
		    sysdate()
		    )
	</update>
	
	<update id="deleteGoodsDirectType" parameterType="map">
		 /* 제조사 직생물품 삭제 (deleteGoodsDirectType) */
	     DELETE from tn_bid_business_goods_direct
         WHERE business_no =  #{business_no}
	</update>
	
	<update id="insertGoodsDirectType" parameterType="map">
	        /* 제조사 직생물품 등록 (insertGoodsDirectType) */
		    insert into tn_bid_business_goods_direct
		    (
		    business_no,
		    goods_no,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{goods_no},
		    sysdate(),
		    sysdate()
		    )
	</update>
	
	<update id="insertCompanylicense" parameterType="map">
	    /* 적격정보 저장 (insertCompanylicense) */	    
	  		insert into tn_bid_business_license
		    (
		    business_no,
		    license_cd,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{license_cd},
		    sysdate(),
		    sysdate()
		    )
	</update>
	
	<select id="selectLicenseList" parameterType="map" resultType="HashMap">
	    /* 적격정보 조회 (selectLicenseList) */
	    SELECT A.license_cd, A.limit_dt, B.cd_nm
        FROM tn_bid_business_license A
        LEFT OUTER JOIN tn_common_cd B ON A.license_cd = B.cd
        WHERE A.business_no =  #{business_no}
     	ORDER BY B.cd_group_id asc, B.depth asc, B.parent_cd asc, B.cd_seq asc   
	</select>
	
	<update id="removeLicenseList" parameterType="map">
		 /* 적격정보 삭제 (removeLicenseList) */
	     DELETE from tn_bid_business_license
         WHERE license_cd = #{license_cd}
         AND business_no =  #{business_no}
	</update>
	
	<select id="selectLicenseTotalList" parameterType="map" resultType="HashMap">
	    /* 적격정보 조회 (selectLicenseTotalList) */
		SELECT cd, cd_nm 
	    FROM tn_common_cd
	    WHERE del_yn='N'
		AND (Parent_Cd Is Null   Or Length(Parent_Cd)=0)  
		AND Cd_Group_Id = (Select Cd_Group_Id From Tn_Common_Cd_Group Where Cd_Group_Cd='business_license_cd')
	    AND cd not in (select license_cd from tn_bid_business_license where Business_No = #{business_no})
	    ORDER BY cd_group_id asc, depth asc, parent_cd asc, cd_seq	    
	</select>
	
	<update id="updateLicenseList" parameterType="map">
        /*적격정보 등록 (updateLicenseList) */
	    insert into tn_bid_business_license
	    (
	    business_no
		,license_cd
		,create_dt
		,modify_dt
	    )
	    value(
	    #{business_no}
	    ,#{cd}
	    ,sysdate()
	    ,sysdate()
	    )
	    on duplicate key
		update
		license_cd 				= #{cd},
		create_dt 				= sysdate(),
		modify_dt 				= sysdate()
	</update>
	
	<select id="selectCompanyTypeList" parameterType="map" resultType="HashMap">
	    /* 제조사 업종 조회 (selectCompanyTypeList) */
	    SELECT B.*, (select distinct(C.cd_nm) from tn_biz_gubun_info C where C.cd = B.parent_cd) as parent_nm
        FROM tn_bid_business_type A, tn_biz_gubun_info B
        WHERE A.company_type_cd = B.cd
        AND B.del_yn = 'N'
        AND B.depth = 2
        AND A.business_no =  #{business_no}
        <if test="searchTxt!=null and !searchTxt.equals('')">  
            and (B.cd_nm like CONCAT('%', #{searchTxt}, '%')  or B.cd like CONCAT(#{searchTxt}, '%')    )        
        </if>
     	ORDER BY parent_cd asc, cd asc		    
	</select>
	
	<update id="removeBizCompanyTypeList" parameterType="map">
		 /* 제조사 업종 삭제 (removeBizCompanyTypeList) */
	     DELETE from tn_bid_business_type
         WHERE company_type_cd = #{cd}
         and business_no =  #{business_no}
	</update>
	
	<select id="selectGoodsTypeList" parameterType="map" resultType="HashMap">
	    /* 제조사 물품 조회 (selectGoodsTypeList) */
		 SELECT B.*
         FROM tn_bid_business_goods A, tn_bid_goods_info B
         WHERE A.goods_no = B.goods_no
         and A.business_no =  #{business_no}
        <if test="searchTxt!=null and !searchTxt.equals('')">  
            and (B.goods_nm like CONCAT('%', #{searchTxt}, '%')  or B.goods_no like CONCAT(#{searchTxt}, '%')    )        
        </if>
        
        <trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('goods_no')"> B.goods_no</if>
				    <if test="sort.equals('goods_nm')"> B.goods_nm</if>
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			</choose>
           </trim> 
		    
	</select>
	
	<select id="selectGoodsTypeTotalList" parameterType="map" resultType="HashMap">
		 /* 물품 조회 (selectGoodsTypeTotalList) */
	     SELECT B.*
         FROM tn_bid_goods_info B
         WHERE 1=1
        <if test="searchTxt2!=null and !searchTxt2.equals('')">  
            and B.goods_nm like CONCAT('%', #{searchTxt2}, '%')       
        </if>
        <if test="searchTxt3!=null and !searchTxt3.equals('')">  
            and B.goods_no like CONCAT(#{searchTxt3}, '%')     
        </if>
        
        <trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('goods_no')"> B.goods_no</if>
				    <if test="sort.equals('goods_nm')"> B.goods_nm</if>
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			</choose>
           </trim> 
		 Limit #{pageNo}, #{rows}  
	</select>
	
	<select id="getGoodsTypeTotalCnt" parameterType="map" resultType="Integer">
		 /* 물품 총 갯수 조회 (getGoodsTypeTotalCnt) */
	     SELECT count(*) as cnt
         FROM tn_bid_goods_info B
         WHERE 1=1
        <if test="searchTxt2!=null and !searchTxt2.equals('')">  
            and B.goods_nm like CONCAT('%', #{searchTxt2}, '%')       
        </if>
        <if test="searchTxt3!=null and !searchTxt3.equals('')">  
            and B.goods_no like CONCAT(#{searchTxt3}, '%')     
        </if>
	</select>
	
	<update id="updateBizGoodsTypeList" parameterType="map">
	        /* 제조사 물품 등록 (updateBizGoodsTypeList) */
		    insert into tn_bid_business_goods
		    (
		    business_no,
		    goods_no,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{goods_no},
		    sysdate(),
		    sysdate()
		    )
		    on duplicate key
			update
			modify_dt=sysdate()
	</update>
	
	<update id="removeBizGoodsTypeList" parameterType="map">
		 /* 제조사 물품 삭제 (removeBizGoodsTypeList) */
	     DELETE from tn_bid_business_goods
         WHERE goods_no = #{goods_no}
         and business_no =  #{business_no}
	</update>
	
	<select id="selectGoodsDirectList" parameterType="map" resultType="HashMap">
	    /* 제조사 직생물품 조회 (selectGoodsDirectList) */
		 SELECT B.*, A.limit_dt
         FROM tn_bid_business_goods_direct A, tn_bid_goods_info B
         WHERE A.goods_no = B.goods_no
         and A.business_no =  #{business_no}
        <if test="searchTxt!=null and !searchTxt.equals('')">  
            and (B.goods_nm like CONCAT('%', #{searchTxt}, '%')  or B.goods_no like CONCAT(#{searchTxt}, '%')    )        
        </if>
        
        <trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('goods_no')"> B.goods_no</if>
				    <if test="sort.equals('goods_nm')"> B.goods_nm</if>
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			</choose>
           </trim> 
		    
	</select>
	
	<select id="selectGoodsDirectTotalList" parameterType="map" resultType="HashMap">
		 /* 직생물품 조회 (selectGoodsDirectTotalList) */
	     SELECT B.*
         FROM tn_bid_goods_info B
         WHERE 1=1
        <if test="searchTxt2!=null and !searchTxt2.equals('')">  
            and B.goods_nm like CONCAT('%', #{searchTxt2}, '%')       
        </if>
        <if test="searchTxt3!=null and !searchTxt3.equals('')">  
            and B.goods_no like CONCAT(#{searchTxt3}, '%')     
        </if>
        
        <trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('goods_no')"> B.goods_no</if>
				    <if test="sort.equals('goods_nm')"> B.goods_nm</if>
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			</choose>
           </trim> 
		 Limit #{pageNo}, #{rows}  
	</select>
	
	<select id="getGoodsDirectTotalCnt" parameterType="map" resultType="Integer">
		 /* 직생물품 총 갯수 조회 (getGoodsDirectTotalCnt) */
	     SELECT count(*) as cnt
         FROM tn_bid_goods_info B
         WHERE 1=1
        <if test="searchTxt2!=null and !searchTxt2.equals('')">  
            and B.goods_nm like CONCAT('%', #{searchTxt2}, '%')       
        </if>
        <if test="searchTxt3!=null and !searchTxt3.equals('')">  
            and B.goods_no like CONCAT(#{searchTxt3}, '%')     
        </if>
	</select>
	
	<update id="updateBizGoodsDirectList" parameterType="map">
	        /* 제조사 직생물품 등록 (updateBizGoodsDirectList) */
		    insert into tn_bid_business_goods_direct
		    (
		    business_no,
		    goods_no,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{goods_no},
		    sysdate(),
		    sysdate()
		    )
		    on duplicate key
			update
			modify_dt=sysdate()
	</update>
	
	<update id="removeBizGoodsDirectList" parameterType="map">
		 /* 제조사 직생물품 삭제 (removeBizGoodsDirectList) */
	     DELETE from tn_bid_business_goods_direct
         WHERE goods_no = #{goods_no}
         and business_no =  #{business_no}
	</update>
	
	<select id="selectCompanyTypeTotalList" parameterType="map" resultType="HashMap">
		 /* 업종 조회 (selectCompanyTypeTotalList) */
			 SELECT B.*, (select distinct(C.cd_nm) from tn_biz_gubun_info C where C.cd = B.parent_cd) as parent_nm
	         FROM tn_biz_gubun_info B
	         WHERE 1=1
	         and del_yn = 'N'
	         and depth = 2
	        <if test="searchTxt2!=null and !searchTxt2.equals('')">  
	            and B.cd_nm like CONCAT('%', #{searchTxt2}, '%')       
	        </if>
	        <if test="searchTxt3!=null and !searchTxt3.equals('')">  
	            and B.cd like CONCAT(#{searchTxt3}, '%')     
	        </if>
	     	order by parent_cd asc, cd asc
        
		 Limit #{pageNo}, #{rows}  
	</select>
	
	<select id="selectLicenseTypeTotalList" parameterType="map" resultType="HashMap">
		 /* 적격정보 조회 (selectLicenseTypeTotalList) */
			 SELECT cd, cd_nm 
	         FROM tn_common_cd
	         WHERE del_yn='N'
			    And (Parent_Cd Is Null   Or Length(Parent_Cd)=0)  
			    And Cd_Group_Id = (Select Cd_Group_Id From Tn_Common_Cd_Group Where Cd_Group_Cd='business_license_cd')
	        and cd not in (select license_cd from tn_bid_business_license where Business_No = #{business_no})
	         order by cd_group_id asc, depth asc, parent_cd asc, cd_seq	  
	</select>
	
	<select id="getCompanyTypeTotalCnt" parameterType="map" resultType="Integer">
		 /* 업종 총 갯수 조회 (getCompanyTypeTotalCnt) */
	     SELECT count(*) as cnt
         FROM tn_biz_gubun_info B
         WHERE 1=1
         and del_yn = 'N'
         and depth = 2
        <if test="searchTxt2!=null and !searchTxt2.equals('')">  
            and B.cd_nm like CONCAT('%', #{searchTxt2}, '%')       
        </if>
        <if test="searchTxt3!=null and !searchTxt3.equals('')">  
            and B.cd like CONCAT(#{searchTxt3}, '%')     
        </if>
	</select>
	
	<update id="updateBizCompanyTypeList" parameterType="map">
	        /* 제조사 업종 등록 (updateBizCompanyTypeList) */
		    insert into tn_bid_business_type
		    (
		    business_no,
		    company_type_cd,
		    create_dt,
		    modify_dt
		    )
		    value(
		    #{business_no},
		    #{cd},
		    sysdate(),
		    sysdate()
		    )
		    on duplicate key
			update
			modify_dt=sysdate()
	</update>
	
	<select id="selectComboEvalList" parameterType="map" resultType="HashMap">
	   /* 평가 콤보 (selectComboEvalList) */	    
	  select distinct(eval_cd) as cd, eval_nm as cd_nm
	  FROM tn_eval_info
	  where eval_type= #{eval_type}
	  AND eval_group = #{eval_group}
	</select>
	
	<select id="selectBusinessList" parameterType="map" resultType="HashMap">
	/* 투찰사 정보 조회 (selectBusinessList) */	    
	  SELECT
	  		DISTINCT (A.company_no),
		    A.business_no,
		    A.company_no,
		    A.company_nm,
		    A.delegate,
		    A.delegate_explain,
		    A.company_type,
		    case when length(A.business_no) > 0 then '1' else '0' end company_type_insert,
		    A.company_registration_day,
		    A.address,
		    fn_common_nm('main_area_cd',A.address, null, null) as address_nm, 
		    A.address_detail,
		    A.phone_no,
		    A.mobile_no,
		    A.fax_no,
		    A.department,
		    A.position,
		    A.bidmanager,
		    A.email,
		    A.business_condition,
		    A.business_condition_detail,
		    A.zip_no,
		    A.file_id1,
		    A.file_id2,
		    A.file_id3,
		    A.file_id4,
		    fn_file_nm(A.file_id1) as file_nm1,
	  		fn_file_nm(A.file_id2) as file_nm2,
	  		fn_file_nm(A.file_id3) as file_nm3,
	  		fn_file_nm(A.file_id4) as file_nm4,
	  		A.msg_info1,
	  		A.msg_info2,
	  		A.msg_info3,
	  		A.pwd,
	  		A.unuse_yn,
	  		A.join_route,
	  		date_format(A.join_req_dt,'%Y-%m-%d %H:%i') as join_req_dt,
	  		A.join_approve_yn,
	  		date_format(B.start_dt,'%Y-%m-%d') as start_dt,
	  		date_format(B.scale_dt,'%Y-%m-%d') as scale_dt,
	  		date_format(B.credit_dt,'%Y-%m-%d') as credit_dt,
	  		B.female_yn,
	  		case when B.credit_dt  <![CDATA[>=]]> (sysdate()-30) then 'A'
			else 'B' end as flag,
	  		date_format(B.female_dt,'%Y-%m-%d') as female_dt,
	  		B.credit_cd,
	  		B.scale_cd,	  		
	  		(select distinct(eval_nm) FROM tn_eval_info where eval_type= '신용평가' and eval_cd = B.credit_cd) as credit_nm,
		    (select distinct(eval_nm) FROM tn_eval_info where eval_type= '기업규모' and eval_cd = B.scale_cd) as scale_nm
		FROM tn_bid_company_info A 
		left outer join tn_bid_company_detail B
		on A.business_no = B.business_no
		WHERE A.gubun='A'
			<if test="s_join_approve_yn!=null and !s_join_approve_yn.equals('')">and A.join_approve_yn = #{s_join_approve_yn}</if>
		    <if test="s_business_no!=null and !s_business_no.equals('')">  and A.business_no like CONCAT('%', #{s_business_no}, '%')            </if>
		    <if test="s_company_no!=null and !s_company_no.equals('')">  and A.company_no like CONCAT('%', #{s_company_no}, '%')            </if>
		    <if test="s_company_nm!=null and !s_company_nm.equals('')">  and A.company_nm like CONCAT('%', #{s_company_nm}, '%')            </if>
		    <if test="s_area_cd!=null and !s_area_cd.equals('')">  and A.address like CONCAT('%', #{s_area_cd}, '%')            </if>
		    <if test="s_area_txt!=null and !s_area_txt.equals('')">  and A.address_detail like CONCAT('%', #{s_area_txt}, '%')            </if>
			<if test="s_company_type!=null and !s_company_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_type where company_type_cd = #{s_company_type})
			</if>
			<if test="s_license_type!=null and !s_license_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_license where license_cd = #{s_license_type})
			</if>
			<if test="s_goods_type!=null and !s_goods_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_goods where goods_no = #{s_goods_type})
			</if>
			<if test="s_goods_direct!=null and !s_goods_direct.equals('')">
				and A.business_no in (select business_no from tn_bid_business_goods_direct where goods_no = #{s_goods_direct})
			</if>
		<trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('business_no')"> A.business_no</if>
				    <if test="sort.equals('company_no')"> A.company_no</if>
					<if test="sort.equals('company_nm')">A.company_nm </if>
					<if test="sort.equals('address')"> A.address</if>
					<if test="sort.equals('start_dt')">B.start_dt </if>
					<if test="sort.equals('nep_yn')">B.nep_yn </if>
					<if test="sort.equals('license_yn')">B.license_yn </if>
					<if test="sort.equals('model_yn')">B.model_yn </if>
					<if test="sort.equals('gdgs_yn')">B.gdgs_yn </if>
					<if test="sort.equals('female_dt')">B.female_dt </if>
					<if test="sort.equals('scale_dt')">B.scale_dt </if>
					<if test="sort.equals('credit_dt')">B.credit_dt </if>
					<if test="sort.equals('innovate_yn')">B.innovate_yn </if>
					<if test="sort.equals('credit_cd')">(select distinct(eval_nm) FROM tn_eval_info where eval_type= '신용평가' and eval_cd = B.credit_cd) </if>
					<if test="sort.equals('scale_cd')">(select distinct(eval_nm) FROM tn_eval_info where eval_type= '기업규모' and eval_cd = B.scale_cd) </if>
					
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			    <otherwise>
			    	A.company_nm asc
			    </otherwise>
			</choose>
        </trim> 
		<if test="pageNo != null and rows != null">
			Limit #{pageNo}, #{rows}
		</if>
	</select>
	
	<select id="selectBusinessExcelList" parameterType="map" resultType="HashMap">
	/* 투찰사 정보 엑셀 조회 (selectBusinessExcelList) */	    
	  SELECT
	  		DISTINCT (A.company_no),
		    A.business_no,
		    A.company_no,
		    A.company_nm,
		    A.delegate,
		    A.delegate_explain,
		    A.company_type,
		    case when length(A.business_no) > 0 then '1' else '0' end company_type_insert,
		    A.company_registration_day,
		    A.address,
		    fn_common_nm('main_area_cd',A.address, null, null) as address_nm, 
		    A.address_detail,
		    A.phone_no,
		    A.mobile_no,
		    A.fax_no,
		    A.department,
		    A.position,
		    A.bidmanager,
		    A.email,
		    A.business_condition,
		    A.business_condition_detail,
		    A.zip_no,
		    A.file_id1,
		    A.file_id2,
		    A.file_id3,
		    A.file_id4,
		    fn_file_nm(A.file_id1) as file_nm1,
	  		fn_file_nm(A.file_id2) as file_nm2,
	  		fn_file_nm(A.file_id3) as file_nm3,
	  		fn_file_nm(A.file_id4) as file_nm4,
	  		A.msg_info1,
	  		A.msg_info2,
	  		A.msg_info3,
	  		A.pwd,
	  		A.unuse_yn,
	  		A.join_route,
	  		date_format(A.join_req_dt,'%Y-%m-%d %H:%i') as join_req_dt,
	  		A.join_approve_yn,
	  		date_format(B.start_dt,'%Y-%m-%d') as start_dt,
	  		date_format(B.scale_dt,'%Y-%m-%d') as scale_dt,
	  		date_format(B.credit_dt,'%Y-%m-%d') as credit_dt,
	  		B.female_yn,
	  		case when B.credit_dt  <![CDATA[>=]]> (sysdate()-30) then 'A'
			else 'B' end as flag,
	  		date_format(B.female_dt,'%Y-%m-%d') as female_dt,
	  		B.credit_cd,
	  		B.scale_cd,	
	  		(
				SELECT GROUP_CONCAT(E.goods_nm SEPARATOR ',') AS goodsList
				FROM tn_bid_company_info C 
				LEFT OUTER JOIN tn_bid_business_goods D ON C.business_no = D.business_no
				LEFT OUTER JOIN tn_bid_goods_info E ON D.goods_NO = E.goods_no
				WHERE C.business_no = A.business_no) AS goodsList,
 			(
				SELECT GROUP_CONCAT(E.cd_nm SEPARATOR ',') AS creditDgreeList
				FROM tn_bid_company_info C
				LEFT OUTER JOIN tn_bid_business_credit_degree D ON C.business_no = D.business_no
				LEFT OUTER JOIN tn_common_cd E ON D.common_cd = E.cd AND E.cd_group_id = 13
				WHERE C.business_no = A.business_no) AS creditDgreeList,	   
	  		(select distinct(eval_nm) FROM tn_eval_info where eval_type= '신용평가' and eval_cd = B.credit_cd) as credit_nm,
		    (select distinct(eval_nm) FROM tn_eval_info where eval_type= '기업규모' and eval_cd = B.scale_cd) as scale_nm,
		    (select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 101) as license1,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 102) as license2,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 201) as license3,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 202) as license4,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 301) as license5,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 303) as license6,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 401) as license7,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 402) as license8,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 501) as license9,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 502) as license10,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 601) as license11,
  	  		(select IF(COUNT(business_no)>0,'Y','N') FROM tn_bid_business_license where A.business_no = business_no AND license_cd = 602) as license12
		FROM tn_bid_company_info A 
		left outer join tn_bid_company_detail B ON A.business_no = B.business_no
		WHERE A.gubun='A'
			<if test="s_join_approve_yn!=null and !s_join_approve_yn.equals('')">and A.join_approve_yn = #{s_join_approve_yn}</if>
		    <if test="s_business_no!=null and !s_business_no.equals('')">  and A.business_no like CONCAT('%', #{s_business_no}, '%')            </if>
		    <if test="s_company_no!=null and !s_company_no.equals('')">  and A.company_no like CONCAT('%', #{s_company_no}, '%')            </if>
		    <if test="s_company_nm!=null and !s_company_nm.equals('')">  and A.company_nm like CONCAT('%', #{s_company_nm}, '%')            </if>
		    <if test="s_area_cd!=null and !s_area_cd.equals('')">  and A.address like CONCAT('%', #{s_area_cd}, '%')            </if>
		    <if test="s_area_txt!=null and !s_area_txt.equals('')">  and A.address_detail like CONCAT('%', #{s_area_txt}, '%')            </if>
			<if test="s_company_type!=null and !s_company_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_type where company_type_cd = #{s_company_type})
			</if>
			<if test="s_license_type!=null and !s_license_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_license where license_cd = #{s_license_type})
			</if>
			<if test="s_goods_type!=null and !s_goods_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_goods where goods_no = #{s_goods_type})
			</if>
			<if test="s_goods_direct!=null and !s_goods_direct.equals('')">
				and A.business_no in (select business_no from tn_bid_business_goods_direct where goods_no = #{s_goods_direct})
			</if>
		<trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('business_no')"> A.business_no</if>
				    <if test="sort.equals('company_no')"> A.company_no</if>
					<if test="sort.equals('company_nm')">A.company_nm </if>
					<if test="sort.equals('address')"> A.address</if>
					<if test="sort.equals('start_dt')">B.start_dt </if>
					<if test="sort.equals('nep_yn')">B.nep_yn </if>
					<if test="sort.equals('license_yn')">B.license_yn </if>
					<if test="sort.equals('model_yn')">B.model_yn </if>
					<if test="sort.equals('gdgs_yn')">B.gdgs_yn </if>
					<if test="sort.equals('female_dt')">B.female_dt </if>
					<if test="sort.equals('scale_dt')">B.scale_dt </if>
					<if test="sort.equals('credit_dt')">B.credit_dt </if>
					<if test="sort.equals('innovate_yn')">B.innovate_yn </if>
					<if test="sort.equals('credit_cd')">(select distinct(eval_nm) FROM tn_eval_info where eval_type= '신용평가' and eval_cd = B.credit_cd) </if>
					<if test="sort.equals('scale_cd')">(select distinct(eval_nm) FROM tn_eval_info where eval_type= '기업규모' and eval_cd = B.scale_cd) </if>
					
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			    <otherwise>
			    	A.company_nm asc
			    </otherwise>
			</choose>
        </trim> 
	</select>
	
	<select id="selectBusinessDtlList" parameterType="map" resultType="HashMap">
	/* 투찰사 정보 조회 (selectBusinessDtlList) */	    
	  SELECT
		    A.business_no,
		    A.company_no,
		    A.company_nm,
		    date_format(B.start_dt,'%Y-%m-%d') as start_dt,
			B.credit_cd,
			date_format(B.credit_dt,'%Y-%m-%d') as credit_dt,
			B.nep_yn,
			B.license_yn,
			B.model_yn,
			B.gdgs_yn,
			date_format(B.female_dt,'%Y-%m-%d') as female_dt,
			B.innovate_yn,
			B.scale_cd,
			date_format(B.scale_dt,'%Y-%m-%d') as scale_dt,
			case when credit_dt  <![CDATA[>=]]> (sysdate()-30) then 'A'
			else 'B' end as flag, 
		    (select distinct(eval_nm) FROM tn_eval_info where eval_type= '신용평가' and eval_cd = B.credit_cd) as credit_nm,
		    (select distinct(eval_nm) FROM tn_eval_info where eval_type= '기업규모' and eval_cd = B.scale_cd) as scale_nm,
		    B.bigo
		FROM tn_bid_company_info A 
		left outer join 
		tn_bid_company_detail B 
		on A.business_no = B.business_no
		WHERE A.gubun='A'
		    <if test="s_business_no!=null and !s_business_no.equals('')">  and A.business_no like CONCAT('%', #{s_business_no}, '%')            </if>
		     <if test="s_company_no!=null and !s_company_no.equals('')">  and A.company_no like CONCAT('%', #{s_company_no}, '%')            </if>
		    <if test="s_company_nm!=null and !s_company_nm.equals('')">  and A.company_nm like CONCAT('%', #{s_company_nm}, '%')            </if>
		    <if test="s_area_cd!=null and !s_area_cd.equals('')">  and A.address like CONCAT('%', #{s_area_cd}, '%')            </if>
		    <if test="s_area_txt!=null and !s_area_txt.equals('')">  and A.address_detail like CONCAT('%', #{s_area_txt}, '%')            </if>
			<if test="s_company_type!=null and !s_company_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_type where company_type_cd = #{s_company_type})
			</if>
			<if test="s_goods_type!=null and !s_goods_type.equals('')">
				and A.business_no in (select business_no from tn_bid_business_goods where goods_no = #{s_goods_type})
			</if>
			<if test="s_goods_direct!=null and !s_goods_direct.equals('')">
				and A.business_no in (select business_no from tn_bid_business_goods_direct where goods_no = #{s_goods_direct})
			</if>
		    
		<trim prefix="ORDER BY">
	        <choose>
			    <when test="sort != null and sort!=''">
					<if test="sort.equals('business_no')"> A.business_no</if>
				    <if test="sort.equals('company_no')"> A.company_no</if>
					<if test="sort.equals('company_nm')">A.company_nm </if>
					<if test="sort.equals('start_dt')">B.start_dt </if>
					<if test="sort.equals('nep_yn')">B.nep_yn </if>
					<if test="sort.equals('license_yn')">B.license_yn </if>
					<if test="sort.equals('model_yn')">B.model_yn </if>
					<if test="sort.equals('gdgs_yn')">B.gdgs_yn </if>
					<if test="sort.equals('female_dt')">B.female_dt </if>
					<if test="sort.equals('scale_dt')">B.scale_dt </if>
					<if test="sort.equals('credit_dt')">B.credit_dt </if>
					<if test="sort.equals('innovate_yn')">B.innovate_yn </if>
					<if test="sort.equals('credit_cd')">(select distinct(eval_nm) FROM tn_eval_info where eval_type= '신용평가' and eval_cd = B.credit_cd) </if>
					<if test="sort.equals('scale_cd')">(select distinct(eval_nm) FROM tn_eval_info where eval_type= '기업규모' and eval_cd = B.scale_cd) </if>
					
					<if test="order!=null and order.equals('desc')"> desc </if>
					<if test="order!=null and order.equals('asc')"> asc </if>
			    </when>
			</choose>
        </trim> 
		Limit #{pageNo}, #{rows}
	</select>
	
	<select id="getBusinessListCnt" parameterType="map" resultType="Integer">
		SELECT count(*) as cnt 
		from tn_bid_company_info
		WHERE gubun='A'
			<if test="s_join_approve_yn!=null and !s_join_approve_yn.equals('')">and join_approve_yn = #{s_join_approve_yn}</if>
		    <if test="s_company_no!=null and !s_company_no.equals('')">  and company_no like CONCAT('%', #{s_company_no}, '%')            </if>
		    <if test="s_company_nm!=null and !s_company_nm.equals('')">  and company_nm like CONCAT('%', #{s_company_nm}, '%')            </if>
		    <if test="s_area_cd!=null and !s_area_cd.equals('')">  and address like CONCAT('%', #{s_area_cd}, '%')            </if>
			<if test="s_area_txt!=null and !s_area_txt.equals('')">  and address_detail like CONCAT('%', #{s_area_txt}, '%')            </if>
			<if test="s_company_type!=null and !s_company_type.equals('')">
				and business_no in (select business_no from tn_bid_business_type where company_type_cd = #{s_company_type})
			</if>
			<if test="s_license_type!=null and !s_license_type.equals('')">
				and business_no in (select business_no from tn_bid_business_license where license_cd = #{s_license_type})
			</if>
			<if test="s_goods_type!=null and !s_goods_type.equals('')">
				and business_no in (select business_no from tn_bid_business_goods where goods_no = #{s_goods_type})
			</if>
			<if test="s_goods_direct!=null and !s_goods_direct.equals('')">
				and business_no in (select business_no from tn_bid_business_goods_direct where goods_no = #{s_goods_direct})
			</if>
	</select>
	
	<update id="updateCompanyFileList" parameterType="map">
	    /* 프로젝트 파일  (updateCompanyFileList) */	
	    UPDATE tn_bid_company_info
		set
			file_id1 =	#{file_id1},
			file_id2 =	#{file_id2},
			file_id3 =	#{file_id3},
			file_id4 =	#{file_id4}
		where business_no = #{business_no}
   </update>
   
   <select id="selectFileDtl" parameterType="map" resultType="HashMap">
	/* 투찰사 정보 조회 (selectBusinessList) */	    
	  SELECT
		    file_id1,
		    file_id2,
		    file_id3,
		    file_id4,
		    fn_file_nm(file_id1) as file_nm1,
	  		fn_file_nm(file_id2) as file_nm2,
	  		fn_file_nm(file_id3) as file_nm3,
	  		fn_file_nm(file_id4) as file_nm4
		FROM tn_bid_company_info 
		WHERE gubun='A'
		and business_no = #{business_no}
	</select>
	
	<update id="updateBusinessList" parameterType="map">
			update tn_bid_company_info
			set
				business_no = business_no
				<if test="company_no!=null and !company_no.equals('')">
					,company_no 				= #{company_no}
				</if>
				<if test="company_nm!=null and !company_nm.equals('')">
					,company_nm 				= #{company_nm}
				</if>
				<if test="delegate!=null and !delegate.equals('')">
					,delegate 				= #{delegate}
				</if>
				<if test="address!=null and !address.equals('')">
					,address 				= #{address}
				</if>
				<if test="address_detail!=null and !address_detail.equals('')">
					,address_detail 			= #{address_detail}
				</if>
				<if test="phone_no!=null and !phone_no.equals('')">
					,phone_no 				= #{phone_no}
				</if>
				<if test="mobile_no!=null and !mobile_no.equals('')">
					,mobile_no 				= #{mobile_no}
				</if>
				<if test="department!=null and !department.equals('')">
					,department				= #{department}
				</if>
				<if test="position!=null and !position.equals('')">
					,position 				= #{position}
				</if>
				<if test="bidmanager!=null and !bidmanager.equals('')">
					,bidmanager				= #{bidmanager}
				</if>
				<if test="email!=null and !email.equals('')">
					,email 					= #{email}
				</if>
				<if test="unuse_yn!=null and !unuse_yn.equals('')">
					,unuse_yn 				= #{unuse_yn}
				</if>
				<if test="pwd!=null and !pwd.equals('')">
					,pwd						= #{pwd}
				</if>
				<if test="join_route!=null and !join_route.equals('')">
					,join_route				= #{join_route}
				</if>
				<if test="join_approve_yn!=null and !join_approve_yn.equals('')">
					,join_approve_yn			= #{join_approve_yn}
				</if>
			WHERE gubun='A'
			and business_no = #{business_no}
    </update>
    
    <update id="updateBusinessList2" parameterType="map">		
			insert into tn_bid_company_detail
		    (
		    business_no,
		    start_dt,
		    scale_cd,
		    scale_dt,
		    credit_cd,
		    credit_dt,
		    female_yn,
		    female_dt
		    )
		    value(
		    #{business_no},
		    #{start_dt},
		    #{scale_cd},
		    #{scale_dt},
		    #{credit_cd},
		    #{credit_dt},
		    #{female_yn},
		    #{female_dt}
		    )
		    ON DUPLICATE key
			UPDATE
		    start_dt 				= #{start_dt},
			scale_cd 				= #{scale_cd},
			scale_dt 				= #{scale_dt},
			credit_cd 				= #{credit_cd},
			credit_dt 				= #{credit_dt},
			female_yn 				= #{female_yn},
			female_dt 				= #{female_dt} 						
    </update>
    
    <update id="updateGoodsDirectType" parameterType="map">
        /* 직생물품 변경 (updateGoodsDirectType) */
	    UPDATE tn_bid_business_goods_direct
	    SET 
	    	limit_dt = #{limit_dt},
	    	modify_dt = sysdate()
		WHERE business_no = #{business_no}
		AND goods_no = #{goods_no}
	</update>
	
    <update id="updateBusinessLicense" parameterType="map">
        /* 적격정보 변경 (updateBusinessLicense) */
	    UPDATE tn_bid_business_license
	    SET 
	    	limit_dt = #{limit_dt},
	    	modify_dt = sysdate()
		WHERE business_no = #{business_no}
		AND license_cd = #{license_cd}
	</update>
</mapper>
